#include "VM/Interpreter.hpp"

namespace fer
{

FERAL_FUNC(createEnum, 1, true,
           " fn(values...) -> Enum\n"
           "Creates and returns an Enum using the given values")
{
    MemoryManager &mem = vm.getMemoryManager();
    VarStruct *res     = vm.makeVar<VarStruct>(loc, nullptr, args.size() + assnArgs.size() - 1);

    for(size_t i = 1; i < args.size(); ++i) {
        auto &a = args[i];
        EXPECT_AND(VarStr, a, "enums (use string / atom)", vm.decVarRef(res));
        res->setAttr(mem, as<VarStr>(a)->getVal(), vm.makeVarWithRef<VarInt>(loc, i - 1), false);
    }

    for(auto &a : assnArgs) {
        EXPECT_AND(VarInt, a.second.val, "enum field value", vm.decVarRef(res));
        res->setAttr(mem, a.first, vm.copyVar(loc, a.second.val), false);
    }

    return res;
}

} // namespace fer